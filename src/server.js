"use strict";
// server.ts
// Server entry point
Object.defineProperty(exports, "__esModule", { value: true });
const app_1 = require("./app");
const database_1 = require("./config/database");
const env_1 = require("./config/env");
const cron_service_1 = require("./services/cron.service");
const startServer = async () => {
    try {
        // Connect to MongoDB
        await (0, database_1.connectDatabase)();
        // Create Express app
        const app = (0, app_1.createApp)();
        // Start cron jobs
        const cronService = new cron_service_1.CronService();
        cronService.startCronJobs();
        // Start server
        const server = app.listen(env_1.env.PORT, () => {
            console.log('');
            console.log('üöÄ ========================================');
            console.log(`   ImageOpt Backend API - v1.0.0`);
            console.log('üöÄ ========================================');
            console.log(`   Environment: ${env_1.env.NODE_ENV}`);
            console.log(`   Port: ${env_1.env.PORT}`);
            console.log(`   Database: Connected`);
            console.log(`   S3 Bucket: ${env_1.env.S3_ORIGINAL_BUCKET}`);
            console.log(`   CloudFront: ${env_1.env.CLOUDFRONT_DOMAIN}`);
            console.log(`   üßπ Cleanup: Every 6hrs (90hrs retention)`);
            console.log('');
            console.log(`   üìù API Documentation:`);
            console.log(`      POST   /api/auth/register`);
            console.log(`      POST   /api/auth/login`);
            console.log(`      GET    /api/auth/me`);
            console.log(`      POST   /api/assets/upload-url`);
            console.log(`      POST   /api/assets`);
            console.log(`      GET    /api/assets`);
            console.log(`      GET    /api/assets/:id`);
            console.log(`      GET    /api/assets/:id/stats`);
            console.log(`      DELETE /api/assets/:id`);
            console.log('');
            console.log(`   üåê Server ready at: http://localhost:${env_1.env.PORT}`);
            console.log(`   üè• Health check: http://localhost:${env_1.env.PORT}/health`);
            console.log('üöÄ ========================================');
            console.log('');
        });
        // Graceful shutdown
        process.on('SIGTERM', () => {
            console.log('SIGTERM signal received: closing HTTP server');
            server.close(() => {
                console.log('HTTP server closed');
                process.exit(0);
            });
        });
        process.on('SIGINT', () => {
            console.log('SIGINT signal received: closing HTTP server');
            server.close(() => {
                console.log('HTTP server closed');
                process.exit(0);
            });
        });
    }
    catch (error) {
        console.error('‚ùå Server startup failed:', error);
        process.exit(1);
    }
};
startServer();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxZQUFZO0FBQ1oscUJBQXFCOztBQUVyQiwrQkFBa0M7QUFDbEMsZ0RBQW9EO0FBQ3BELHNDQUFtQztBQUNuQywwREFBc0Q7QUFFdEQsTUFBTSxXQUFXLEdBQUcsS0FBSyxJQUFtQixFQUFFO0lBQzVDLElBQUksQ0FBQztRQUNILHFCQUFxQjtRQUNyQixNQUFNLElBQUEsMEJBQWUsR0FBRSxDQUFDO1FBRXhCLHFCQUFxQjtRQUNyQixNQUFNLEdBQUcsR0FBRyxJQUFBLGVBQVMsR0FBRSxDQUFDO1FBRXhCLGtCQUFrQjtRQUNsQixNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLEVBQUUsQ0FBQztRQUN0QyxXQUFXLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFNUIsZUFBZTtRQUNmLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsU0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUU7WUFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7WUFDM0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1lBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsNkNBQTZDLENBQUMsQ0FBQztZQUMzRCxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixTQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUMvQyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksU0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7WUFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1lBQ3RDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLFNBQUcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUM7WUFDdkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsU0FBRyxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQztZQUN2RCxPQUFPLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7WUFDM0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1lBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsOEJBQThCLENBQUMsQ0FBQztZQUM1QyxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixDQUFDLENBQUM7WUFDekMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO1lBQ25ELE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUN4QyxPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1lBQzVDLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0NBQW9DLENBQUMsQ0FBQztZQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7WUFDNUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLDJDQUEyQyxTQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUNuRSxPQUFPLENBQUMsR0FBRyxDQUFDLHdDQUF3QyxTQUFHLENBQUMsSUFBSSxTQUFTLENBQUMsQ0FBQztZQUN2RSxPQUFPLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7WUFDM0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQixDQUFDLENBQUMsQ0FBQztRQUVILG9CQUFvQjtRQUNwQixPQUFPLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7WUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO1lBQzVELE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFO2dCQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7Z0JBQ2xDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEIsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtZQUN4QixPQUFPLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7WUFDM0QsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUU7Z0JBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztnQkFDbEMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2pELE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEIsQ0FBQztBQUNILENBQUMsQ0FBQztBQUVGLFdBQVcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gc2VydmVyLnRzXHJcbi8vIFNlcnZlciBlbnRyeSBwb2ludFxyXG5cclxuaW1wb3J0IHsgY3JlYXRlQXBwIH0gZnJvbSAnLi9hcHAnO1xyXG5pbXBvcnQgeyBjb25uZWN0RGF0YWJhc2UgfSBmcm9tICcuL2NvbmZpZy9kYXRhYmFzZSc7XHJcbmltcG9ydCB7IGVudiB9IGZyb20gJy4vY29uZmlnL2Vudic7XHJcbmltcG9ydCB7IENyb25TZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9jcm9uLnNlcnZpY2UnO1xyXG5cclxuY29uc3Qgc3RhcnRTZXJ2ZXIgPSBhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIENvbm5lY3QgdG8gTW9uZ29EQlxyXG4gICAgYXdhaXQgY29ubmVjdERhdGFiYXNlKCk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIEV4cHJlc3MgYXBwXHJcbiAgICBjb25zdCBhcHAgPSBjcmVhdGVBcHAoKTtcclxuXHJcbiAgICAvLyBTdGFydCBjcm9uIGpvYnNcclxuICAgIGNvbnN0IGNyb25TZXJ2aWNlID0gbmV3IENyb25TZXJ2aWNlKCk7XHJcbiAgICBjcm9uU2VydmljZS5zdGFydENyb25Kb2JzKCk7XHJcblxyXG4gICAgLy8gU3RhcnQgc2VydmVyXHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhcHAubGlzdGVuKGVudi5QT1JULCAoKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCcnKTtcclxuICAgICAgY29uc29sZS5sb2coJ/CfmoAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScpO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAgSW1hZ2VPcHQgQmFja2VuZCBBUEkgLSB2MS4wLjBgKTtcclxuICAgICAgY29uc29sZS5sb2coJ/CfmoAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScpO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAgRW52aXJvbm1lbnQ6ICR7ZW52Lk5PREVfRU5WfWApO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAgUG9ydDogJHtlbnYuUE9SVH1gKTtcclxuICAgICAgY29uc29sZS5sb2coYCAgIERhdGFiYXNlOiBDb25uZWN0ZWRgKTtcclxuICAgICAgY29uc29sZS5sb2coYCAgIFMzIEJ1Y2tldDogJHtlbnYuUzNfT1JJR0lOQUxfQlVDS0VUfWApO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAgQ2xvdWRGcm9udDogJHtlbnYuQ0xPVURGUk9OVF9ET01BSU59YCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKGAgICDwn6e5IENsZWFudXA6IEV2ZXJ5IDZocnMgKDkwaHJzIHJldGVudGlvbilgKTtcclxuICAgICAgY29uc29sZS5sb2coJycpO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAg8J+TnSBBUEkgRG9jdW1lbnRhdGlvbjpgKTtcclxuICAgICAgY29uc29sZS5sb2coYCAgICAgIFBPU1QgICAvYXBpL2F1dGgvcmVnaXN0ZXJgKTtcclxuICAgICAgY29uc29sZS5sb2coYCAgICAgIFBPU1QgICAvYXBpL2F1dGgvbG9naW5gKTtcclxuICAgICAgY29uc29sZS5sb2coYCAgICAgIEdFVCAgICAvYXBpL2F1dGgvbWVgKTtcclxuICAgICAgY29uc29sZS5sb2coYCAgICAgIFBPU1QgICAvYXBpL2Fzc2V0cy91cGxvYWQtdXJsYCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKGAgICAgICBQT1NUICAgL2FwaS9hc3NldHNgKTtcclxuICAgICAgY29uc29sZS5sb2coYCAgICAgIEdFVCAgICAvYXBpL2Fzc2V0c2ApO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAgICAgR0VUICAgIC9hcGkvYXNzZXRzLzppZGApO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAgICAgR0VUICAgIC9hcGkvYXNzZXRzLzppZC9zdGF0c2ApO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAgICAgREVMRVRFIC9hcGkvYXNzZXRzLzppZGApO1xyXG4gICAgICBjb25zb2xlLmxvZygnJyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKGAgICDwn4yQIFNlcnZlciByZWFkeSBhdDogaHR0cDovL2xvY2FsaG9zdDoke2Vudi5QT1JUfWApO1xyXG4gICAgICBjb25zb2xlLmxvZyhgICAg8J+PpSBIZWFsdGggY2hlY2s6IGh0dHA6Ly9sb2NhbGhvc3Q6JHtlbnYuUE9SVH0vaGVhbHRoYCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5qAID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nKTtcclxuICAgICAgY29uc29sZS5sb2coJycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gR3JhY2VmdWwgc2h1dGRvd25cclxuICAgIHByb2Nlc3Mub24oJ1NJR1RFUk0nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdTSUdURVJNIHNpZ25hbCByZWNlaXZlZDogY2xvc2luZyBIVFRQIHNlcnZlcicpO1xyXG4gICAgICBzZXJ2ZXIuY2xvc2UoKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIHNlcnZlciBjbG9zZWQnKTtcclxuICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcHJvY2Vzcy5vbignU0lHSU5UJywgKCkgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZygnU0lHSU5UIHNpZ25hbCByZWNlaXZlZDogY2xvc2luZyBIVFRQIHNlcnZlcicpO1xyXG4gICAgICBzZXJ2ZXIuY2xvc2UoKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIHNlcnZlciBjbG9zZWQnKTtcclxuICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBTZXJ2ZXIgc3RhcnR1cCBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgcHJvY2Vzcy5leGl0KDEpO1xyXG4gIH1cclxufTtcclxuXHJcbnN0YXJ0U2VydmVyKCk7XHJcbiJdfQ==