{
  "info": {
    "name": "ImageOpt Backend API",
    "description": "Complete API collection for testing the image optimization backend",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "token",
      "value": "",
      "type": "string"
    },
    {
      "key": "assetId",
      "value": "",
      "type": "string"

    }
  ],
  "item": [
    {
      "name": "Health Check",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        }
      }
    },
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.token) {",
                  "        pm.collectionVariables.set('token', jsonData.data.token);",
                  "        console.log('Token saved:', jsonData.data.token);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.token) {",
                  "        pm.collectionVariables.set('token', jsonData.data.token);",
                  "        console.log('Token saved:', jsonData.data.token);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "me"]
            }
          }
        }
      ]
    },
    {
      "name": "Assets",
      "item": [
        {
          "name": "Get Upload URL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.uploadUrl) {",
                  "        console.log('Upload URL:', jsonData.data.uploadUrl);",
                  "        console.log('S3 Key:', jsonData.data.s3Key);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fileName\": \"test-image.jpg\",\n  \"fileType\": \"image/jpeg\",\n  \"fileSize\": 1048576,\n  \"folder\": \"products\",\n  \"customFileName\": \"laptop-macbook-pro.jpg\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/assets/upload-url",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "upload-url"]
            }
          }
        },
        {
          "name": "Direct Upload (Form-Data)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.asset) {",
                  "        pm.collectionVariables.set('assetId', jsonData.data.asset._id);",
                  "        console.log('âœ… Asset uploaded!');",
                  "        console.log('Asset ID:', jsonData.data.asset._id);",
                  "        console.log('S3 Key:', jsonData.data.s3Key);",
                  "        console.log('CloudFront URL:', jsonData.data.cloudfrontUrl);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "folder",
                  "value": "products",
                  "type": "text"
                },
                {
                  "key": "customFileName",
                  "value": "laptop-macbook-pro.jpg",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/assets/direct-upload",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "direct-upload"]
            }
          }
        },
        {
          "name": "Create Asset",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.asset) {",
                  "        pm.collectionVariables.set('assetId', jsonData.data.asset._id);",
                  "        console.log('Asset ID saved:', jsonData.data.asset._id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fileName\": \"test-image.jpg\",\n  \"fileType\": \"image/jpeg\",\n  \"fileSize\": 1048576,\n  \"s3Key\": \"users/123/1234567890-abc123.jpg\",\n  \"s3Bucket\": \"imageopt-original-329599656829-us-east-1\",\n  \"metadata\": {\n    \"width\": 1920,\n    \"height\": 1080,\n    \"format\": \"jpeg\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/assets",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets"]
            }
          }
        },
        {
          "name": "List Assets",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "List Folders",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ“ Folders:', jsonData.data.folders);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/folders",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "folders"]
            }
          }
        },
        {
          "name": "Get Folder Assets",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ“¦ Folder:', jsonData.data.folder);",
                  "    console.log('Assets:', jsonData.data.assets.length);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/folders/products?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "folders", "products"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "Get Asset Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}"]
            }
          }
        },
        {
          "name": "Get Asset Bandwidth Stats",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}/stats",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}", "stats"]
            }
          }
        },
        {
          "name": "Get Signed URL (Default Expiry)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.signedUrl) {",
                  "        console.log('ðŸ” Signed URL Generated!');",
                  "        console.log('URL:', jsonData.data.signedUrl);",
                  "        console.log('Expires At:', jsonData.data.expiresAt);",
                  "        console.log('Expires In:', jsonData.data.expiresInSeconds, 'seconds');",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}/signed-url",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}", "signed-url"]
            }
          }
        },
        {
          "name": "Get Signed URL (With Transformations)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data && jsonData.data.signedUrl) {",
                  "        console.log('ðŸ” Signed URL Generated with Transformations!');",
                  "        console.log('URL:', jsonData.data.signedUrl);",
                  "        console.log('Expires At:', jsonData.data.expiresAt);",
                  "        console.log('Expires In:', jsonData.data.expiresInSeconds, 'seconds');",
                  "        console.log('Transformations:', jsonData.data.transformations);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}/signed-url?expiresIn=7200&format=webp&width=800&quality=80",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}", "signed-url"],
              "query": [
                {
                  "key": "expiresIn",
                  "value": "7200",
                  "description": "Custom expiry in seconds (2 hours)"
                },
                {
                  "key": "format",
                  "value": "webp",
                  "description": "Output format: jpeg, png, webp, avif (optional - defaults to file extension)"
                },
                {
                  "key": "width",
                  "value": "800",
                  "description": "Resize width in pixels (optional)"
                },
                {
                  "key": "quality",
                  "value": "80",
                  "description": "Compression quality 1-100 (optional)"
                }
              ]
            }
          }
        },
        {
          "name": "Restore Asset",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('âœ… Asset restored successfully!');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}/restore",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}", "restore"]
            }
          }
        },
        {
          "name": "Delete Asset",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}"]
            }
          }
        },
        {
          "name": "Make Asset Private",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ”’ Asset moved to private folder!');",
                  "    console.log('New S3 Key:', jsonData.data.asset.newS3Key);",
                  "    console.log('Now requires signed URL for access');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}/make-private",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}", "make-private"]
            }
          }
        },
        {
          "name": "Make Asset Public",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ”“ Asset moved to public folder!');",
                  "    console.log('New S3 Key:', jsonData.data.asset.newS3Key);",
                  "    console.log('Folder:', jsonData.data.asset.folder);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}/make-public?folder=products",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}", "make-public"],
              "query": [
                {
                  "key": "folder",
                  "value": "products",
                  "description": "Target folder name (optional, defaults to original folder or 'public')"
                }
              ]
            }
          }
        },
        {
          "name": "Invalidate Cache",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ—‘ï¸ Cache invalidation initiated!');",
                  "    console.log('Invalidation ID:', jsonData.data.invalidation.id);",
                  "    console.log('Status:', jsonData.data.invalidation.status);",
                  "    console.log('Paths:', jsonData.data.invalidation.paths);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/assets/{{assetId}}/invalidate-cache",
              "host": ["{{baseUrl}}"],
              "path": ["api", "assets", "{{assetId}}", "invalidate-cache"]
            }
          }
        }
      ]
    },
    {
      "name": "Analytics",
      "item": [
        {
          "name": "Get User Bandwidth & Cost",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data) {",
                  "        console.log('ðŸ“Š Bandwidth Stats:');",
                  "        console.log('Total GB:', jsonData.data.bandwidth.totalGB);",
                  "        console.log('Total Cost USD:', jsonData.data.cost.totalUSD);",
                  "        console.log('Cache Hit Ratio:', jsonData.data.requests.cacheHitRatio);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/analytics/bandwidth",
              "host": ["{{baseUrl}}"],
              "path": ["api", "analytics", "bandwidth"]
            }
          }
        },
        {
          "name": "Get Bandwidth with Date Range",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ“… Period:', jsonData.data.period.startDate, 'to', jsonData.data.period.endDate);",
                  "    console.log('ðŸ’° Total Cost: $' + jsonData.data.cost.totalUSD);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/analytics/bandwidth?startDate=2025-12-01&endDate=2025-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["api", "analytics", "bandwidth"],
              "query": [
                {
                  "key": "startDate",
                  "value": "2025-12-01"
                },
                {
                  "key": "endDate",
                  "value": "2025-12-31"
                }
              ]
            }
          }
        },
        {
          "name": "Get Per-Asset Bandwidth",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ“¦ Assets with bandwidth:');",
                  "    jsonData.data.assets.forEach(asset => {",
                  "        console.log(`  - ${asset.name}: ${asset.totalGB} GB ($${asset.costUSD})`);",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/analytics/bandwidth/assets?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["api", "analytics", "bandwidth", "assets"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "Get Daily Bandwidth Stats",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ“ˆ Daily Stats:');",
                  "    console.log('Period:', jsonData.data.period.startDate, 'to', jsonData.data.period.endDate);",
                  "    console.log('Total days:', jsonData.data.daily.length);",
                  "    console.log('Total bandwidth:', jsonData.data.totals.totalGB, 'GB');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/analytics/bandwidth/daily?startDate=2025-12-01&endDate=2025-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["api", "analytics", "bandwidth", "daily"],
              "query": [
                {
                  "key": "startDate",
                  "value": "2025-12-01"
                },
                {
                  "key": "endDate",
                  "value": "2025-12-31"
                }
              ]
            }
          }
        },
        {
          "name": "Get Chart Data",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log('ðŸ“Š Chart Data:');",
                  "    console.log('GroupBy:', jsonData.data.period.groupBy);",
                  "    console.log('Data points:', jsonData.data.chart.labels.length);",
                  "    console.log('Total requests:', jsonData.data.totals.requests);",
                  "    console.log('Total cost: $' + jsonData.data.totals.costUSD);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/analytics/charts?startDate=2025-01-01&endDate=2025-12-31&groupBy=month",
              "host": ["{{baseUrl}}"],
              "path": ["api", "analytics", "charts"],
              "query": [
                {
                  "key": "startDate",
                  "value": "2025-01-01",
                  "description": "Start date (ISO format)"
                },
                {
                  "key": "endDate",
                  "value": "2025-12-31",
                  "description": "End date (ISO format)"
                },
                {
                  "key": "groupBy",
                  "value": "month",
                  "description": "Group by: day, month, or year"
                }
              ]
            }
          }
        }
      ]
    }
  ]
}
